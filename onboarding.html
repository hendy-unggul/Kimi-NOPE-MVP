<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOPE - Choose Your Rage</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000000;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
        }
        
        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 10px;
        }
        .header h1 {
            font-size: 2.2rem;
            color: #ff3b30;
            margin-bottom: 8px;
        }
        .header p {
            color: #888888;
            font-size: 0.9rem;
        }
        
        /* User Info */
        .user-info {
            background: #111111;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
            border: 1px solid #333333;
            text-align: center;
        }
        .user-info strong {
            color: #ff3b30;
        }
        
        /* Zone Sections */
        .zone-section {
            margin-bottom: 30px;
        }
        .zone-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #333333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .zone-title .emoji {
            font-size: 1.2rem;
        }
        .pop-culture { color: #34c759; }
        .personal-pain { color: #ff9500; }
        .social-sickness { color: #ff3b30; }
        .movement { color: #5ac8fa; }
        
        /* Hashtag Grid */
        .hashtag-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 12px;
            margin-bottom: 15px;
        }
        .hashtag {
            background: #111111;
            padding: 18px;
            border-radius: 10px;
            cursor: pointer;
            border: 1px solid #333333;
            transition: all 0.2s ease;
        }
        .hashtag:hover {
            background: #1a1a1a;
            transform: translateY(-2px);
        }
        .hashtag.selected {
            background: rgba(255, 59, 48, 0.1);
            border-color: #ff3b30;
            box-shadow: 0 4px 12px rgba(255, 59, 48, 0.2);
        }
        .hashtag .name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 8px;
            line-height: 1.3;
        }
        .hashtag .posts {
            color: #888888;
            font-size: 0.85rem;
            margin-top: 8px;
        }
        .selected-badge {
            color: #ff3b30;
            font-weight: bold;
            font-size: 0.9rem;
            margin-top: 8px;
        }
        
        /* Selection Counter */
        .selection-counter {
            position: sticky;
            top: 10px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #333333;
            margin: 20px auto 30px;
            text-align: center;
            z-index: 100;
        }
        .counter-number {
            font-size: 3.5rem;
            font-weight: 900;
            line-height: 1;
            margin-bottom: 5px;
        }
        .counter-text {
            color: #888888;
            font-size: 0.9rem;
        }
        
        /* Rage Input Section */
        .rage-section {
            background: #111111;
            border-radius: 15px;
            padding: 25px;
            margin: 40px 0 30px;
            border: 1px solid #333333;
        }
        .rage-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .rage-title i {
            color: #ff3b30;
        }
        .rage-input-container {
            position: relative;
            margin-bottom: 15px;
        }
        .rage-textarea {
            width: 100%;
            height: 120px;
            background: #1a1a1a;
            border: 1px solid #333333;
            border-radius: 12px;
            padding: 18px;
            color: white;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.2s;
        }
        .rage-textarea:focus {
            outline: none;
            border-color: #ff3b30;
        }
        .rage-textarea:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .char-counter {
            position: absolute;
            bottom: 10px;
            right: 15px;
            color: #888888;
            font-size: 0.9rem;
        }
        .char-counter.warning {
            color: #ff9500;
        }
        .char-counter.danger {
            color: #ff3b30;
            font-weight: bold;
        }
        
        /* CTA Button */
        .cta-button {
            display: block;
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #ff3b30, #ff9500);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        .cta-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 59, 48, 0.4);
        }
        .cta-button:active:not(:disabled) {
            transform: translateY(0);
        }
        .cta-button:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            background: #333333;
        }
        
        /* Back Button */
        .back-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #111111;
            color: white;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            border: 1px solid #333333;
            z-index: 1000;
            font-size: 1.2rem;
        }
        .back-btn:hover {
            background: #1a1a1a;
        }
        
        /* Instructions */
        .instructions {
            text-align: center;
            color: #666666;
            font-size: 0.85rem;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333333;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            body { padding: 15px; }
            .hashtag-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 1.8rem; }
            .counter-number { font-size: 2.8rem; }
            .back-btn {
                top: 15px;
                left: 15px;
                width: 40px;
                height: 40px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <a href="login.html" class="back-btn" onclick="localStorage.removeItem('nope_logged_in')">
        ‚Üê
    </a>
    
    <div class="header">
        <h1>Choose Your Rage</h1>
        <p>Select 3 hashtags that represent your deepest annoyances</p>
    </div>
    
    <div class="user-info" id="userInfo">
        Loading your profile...
    </div>
    
    <div class="selection-counter">
        <div class="counter-number" id="selectedCount">0</div>
        <div class="counter-text">out of 3 selected</div>
    </div>
    
    <!-- ZONA 1: POP CULTURE -->
    <div class="zone-section">
        <div class="zone-title pop-culture">
            <span class="emoji">üé¨</span> POP CULTURE ZONE
        </div>
        <div class="hashtag-grid" id="popCultureGrid">
            <!-- Pop Culture hashtags loaded here -->
        </div>
    </div>
    
    <!-- ZONA 2: PERSONAL PAIN -->
    <div class="zone-section">
        <div class="zone-title personal-pain">
            <span class="emoji">üíî</span> PERSONAL PAIN ZONE
        </div>
        <div class="hashtag-grid" id="personalPainGrid">
            <!-- Personal Pain hashtags loaded here -->
        </div>
    </div>
    
    <!-- ZONA 3: SOCIAL SICKNESS -->
    <div class="zone-section">
        <div class="zone-title social-sickness">
            <span class="emoji">üò∑</span> SOCIAL SICKNESS ZONE
        </div>
        <div class="hashtag-grid" id="socialSicknessGrid">
            <!-- Social Sickness hashtags loaded here -->
        </div>
    </div>
    
    <!-- ZONA 4: MOVEMENT -->
    <div class="zone-section">
        <div class="zone-title movement">
            <span class="emoji">üöÄ</span> MOVEMENT ZONE
        </div>
        <div class="hashtag-grid" id="movementGrid">
            <!-- Movement hashtags loaded here -->
        </div>
    </div>
    
    <!-- RAGE INPUT SECTION -->
    <div class="rage-section" id="rageSection" style="display: none;">
        <div class="rage-title">
            <i class="fas fa-fire"></i>
            <span id="rageTitle">RAGE ABOUT <span id="selectedHashtagName" style="color: #ff3b30">#Hashtag</span></span>
        </div>
        
        <div class="rage-input-container">
            <textarea 
                class="rage-textarea" 
                id="rageTextarea"
                placeholder="Type your rage here... (min 10 characters, max 280)"
                maxlength="280"
                disabled
            ></textarea>
            <div class="char-counter" id="charCounter">0/280</div>
        </div>
        
        <button class="cta-button" id="rageSubmitBtn" disabled>
            <i class="fas fa-fire"></i> LEPASKAN EMOSIMU!
        </button>
    </div>
    
    <div class="instructions">
        Select 3 hashtags ‚Üí Write your rage ‚Üí Release your emotions
    </div>

    <script>
        console.log('=== NOPE ONBOARDING WITH ZONES ===');
        
        // Check login
        const username = localStorage.getItem('nope_anon_username');
        const isLoggedIn = localStorage.getItem('nope_logged_in') === 'true';
        
        console.log('User:', username);
        console.log('Logged in:', isLoggedIn);
        
        if (!isLoggedIn || !username) {
            alert('Please login first');
            window.location.href = 'login.html';
        }
        
        // Display username
        document.getElementById('userInfo').innerHTML = 
            `Welcome, <strong style="color: #ff3b30">${username}</strong> | Choose 3 rage zones`;
        
        // Hashtag data by zones
        const HASHTAGS_BY_ZONE = {
            'pop-culture': [
                { id: 'pc1', name: '#BellTiketJualSinjal', category: 'Pop Culture', posts: 89 },
                { id: 'pc2', name: '#InfluencerNgchek', category: 'Pop Culture', posts: 203 },
                { id: 'pc3', name: '#FilmEndingGaje', category: 'Pop Culture', posts: 142 },
                { id: 'pc4', name: '#TikTokCringe', category: 'Pop Culture', posts: 156 },
                { id: 'pc5', name: '#CelebrityFail', category: 'Pop Culture', posts: 98 },
                { id: 'pc6', name: '#ViralGakMutuu', category: 'Pop Culture', posts: 167 }
            ],
            'personal-pain': [
                { id: 'pp1', name: '#MagangDigajiSertifikat', category: 'Personal Pain', posts: 245 },
                { id: 'pp2', name: '#DiajakJalanTapiKempes', category: 'Personal Pain', posts: 178 },
                { id: 'pp3', name: '#DiphostingGebetan', category: 'Personal Pain', posts: 312 },
                { id: 'pp4', name: '#MinjemDuitGaBalik', category: 'Personal Pain', posts: 210 },
                { id: 'pp5', name: '#ProjectLastMinute', category: 'Personal Pain', posts: 189 },
                { id: 'pp6', name: '#JanjiCumaJanji', category: 'Personal Pain', posts: 267 }
            ],
            'social-sickness': [
                { id: 'ss1', name: '#DramaQueenAnjay', category: 'Social Sickness', posts: 189 },
                { id: 'ss2', name: '#BacotLambeTurah', category: 'Social Sickness', posts: 321 },
                { id: 'ss3', name: '#RencanaPlinPlan', category: 'Social Sickness', posts: 267 },
                { id: 'ss4', name: '#GhostingCulture', category: 'Social Sickness', posts: 198 },
                { id: 'ss5', name: '#FlexingGaJelas', category: 'Social Sickness', posts: 145 },
                { id: 'ss6', name: '#PamerCringe', category: 'Social Sickness', posts: 176 }
            ],
            'movement': [
                { id: 'mv1', name: '#ReformasiSistem', category: 'Movement', posts: 312 },
                { id: 'mv2', name: '#AksiNyata2024', category: 'Movement', posts: 189 },
                { id: 'mv3', name: '#VoiceForChange', category: 'Movement', posts: 245 },
                { id: 'mv4', name: '#YouthPower', category: 'Movement', posts: 178 },
                { id: 'mv5', name: '#DigitalProtest', category: 'Movement', posts: 156 },
                { id: 'mv6', name: '#ChangeMakers', category: 'Movement', posts: 134 }
            ]
        };
        
        let selectedHashtags = [];
        const MAX_SELECTION = 3;
        let selectedZoneForRage = null;
        
        // Initialize
        function init() {
            renderAllHashtags();
            setupEventListeners();
            updateSelectionCounter();
        }
        
        // Render hashtags by zone
        function renderAllHashtags() {
            renderZoneHashtags('pop-culture', 'popCultureGrid');
            renderZoneHashtags('personal-pain', 'personalPainGrid');
            renderZoneHashtags('social-sickness', 'socialSicknessGrid');
            renderZoneHashtags('movement', 'movementGrid');
        }
        
        function renderZoneHashtags(zoneKey, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const hashtags = HASHTAGS_BY_ZONE[zoneKey];
            container.innerHTML = '';
            
            hashtags.forEach(hashtag => {
                const isSelected = selectedHashtags.some(h => h.id === hashtag.id);
                
                const div = document.createElement('div');
                div.className = `hashtag ${isSelected ? 'selected' : ''}`;
                div.dataset.id = hashtag.id;
                div.dataset.zone = zoneKey;
                div.dataset.name = hashtag.name;
                
                div.innerHTML = `
                    <div class="name">${hashtag.name}</div>
                    <div class="posts">${hashtag.posts} posts</div>
                    ${isSelected ? '<div class="selected-badge">‚úì SELECTED</div>' : ''}
                `;
                
                div.addEventListener('click', () => toggleHashtagSelection(hashtag, zoneKey));
                container.appendChild(div);
            });
        }
        
        // Toggle hashtag selection
        function toggleHashtagSelection(hashtag, zoneKey) {
            const index = selectedHashtags.findIndex(h => h.id === hashtag.id);
            
            if (index === -1) {
                if (selectedHashtags.length < MAX_SELECTION) {
                    selectedHashtags.push({
                        ...hashtag,
                        zone: zoneKey
                    });
                    showNotification(`Selected: ${hashtag.name}`);
                } else {
                    showNotification(`Maximum ${MAX_SELECTION} hashtags allowed`, 'error');
                    return;
                }
            } else {
                selectedHashtags.splice(index, 1);
                showNotification(`Removed: ${hashtag.name}`);
            }
            
            // Update UI
            renderAllHashtags();
            updateSelectionCounter();
            updateRageSection();
        }
        
        // Update selection counter
        function updateSelectionCounter() {
            const counter = document.getElementById('selectedCount');
            if (counter) {
                counter.textContent = selectedHashtags.length;
                
                // Change color based on selection
                if (selectedHashtags.length === MAX_SELECTION) {
                    counter.style.color = '#ff3b30';
                } else if (selectedHashtags.length > 0) {
                    counter.style.color = '#ff9500';
                } else {
                    counter.style.color = '#888888';
                }
            }
        }
        
        // Update rage section visibility
        function updateRageSection() {
            const rageSection = document.getElementById('rageSection');
            const rageTextarea = document.getElementById('rageTextarea');
            const rageTitle = document.getElementById('selectedHashtagName');
            const submitBtn = document.getElementById('rageSubmitBtn');
            
            if (selectedHashtags.length === MAX_SELECTION) {
                // Show rage section
                rageSection.style.display = 'block';
                
                // Set default selected hashtag for rage
                selectedZoneForRage = selectedHashtags[0];
                rageTitle.textContent = selectedZoneForRage.name;
                
                // Enable textarea
                rageTextarea.disabled = false;
                rageTextarea.placeholder = `Rage about ${selectedZoneForRage.name}...`;
                
                // Scroll to rage section
                setTimeout(() => {
                    rageSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
                
            } else {
                // Hide rage section
                rageSection.style.display = 'none';
                rageTextarea.disabled = true;
                submitBtn.disabled = true;
            }
        }
        
        // Setup event listeners for rage input
        function setupEventListeners() {
            const rageTextarea = document.getElementById('rageTextarea');
            const charCounter = document.getElementById('charCounter');
            const submitBtn = document.getElementById('rageSubmitBtn');
            
            // Character counter
            rageTextarea.addEventListener('input', function() {
                const length = this.value.length;
                charCounter.textContent = `${length}/280`;
                
                // Update color
                charCounter.className = 'char-counter';
                if (length > 200) charCounter.classList.add('warning');
                if (length >= 270) charCounter.classList.add('danger');
                
                // Enable/disable submit button
                submitBtn.disabled = length < 10 || length > 280;
            });
            
            // Submit rage
            submitBtn.addEventListener('click', submitRage);
            
            // Allow clicking on hashtag name to change rage target
            document.getElementById('selectedHashtagName').addEventListener('click', function() {
                if (selectedHashtags.length > 1) {
                    showHashtagSelector();
                }
            });
        }
        
        // Show hashtag selector for rage target
        function showHashtagSelector() {
            const selector = document.createElement('div');
            selector.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.9);
                backdrop-filter: blur(10px);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                padding: 20px;
            `;
            
            selector.innerHTML = `
                <div style="background: #111; padding: 30px; border-radius: 15px; max-width: 400px; width: 100%; border: 2px solid #333;">
                    <h3 style="margin-bottom: 20px; color: #ff3b30;">Select Rage Target</h3>
                    <p style="color: #888; margin-bottom: 20px;">Choose which hashtag you want to rage about:</p>
                    <div id="selectorOptions" style="margin-bottom: 25px;"></div>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="width: 100%; padding: 12px; background: #333; color: white; border: none; border-radius: 10px;">
                        Cancel
                    </button>
                </div>
            `;
            
            document.body.appendChild(selector);
            
            // Add options
            const optionsContainer = document.getElementById('selectorOptions');
            selectedHashtags.forEach(hashtag => {
                const btn = document.createElement('button');
                btn.style.cssText = `
                    display: block;
                    width: 100%;
                    padding: 15px;
                    margin: 8px 0;
                    background: #222;
                    color: white;
                    border: 1px solid #333;
                    border-radius: 10px;
                    text-align: left;
                    cursor: pointer;
                    transition: 0.2s;
                `;
                btn.innerHTML = `
                    <div style="font-weight: bold;">${hashtag.name}</div>
                    <div style="font-size: 0.85rem; color: #888;">${hashtag.zone} ‚Ä¢ ${hashtag.posts} posts</div>
                `;
                btn.onmouseover = () => btn.style.background = '#2a2a2a';
                btn.onmouseout = () => btn.style.background = '#222';
                btn.onclick = () => {
                    selectedZoneForRage = hashtag;
                    document.getElementById('selectedHashtagName').textContent = hashtag.name;
                    document.getElementById('rageTextarea').placeholder = `Rage about ${hashtag.name}...`;
                    selector.remove();
                    showNotification(`Now raging about: ${hashtag.name}`);
                };
                optionsContainer.appendChild(btn);
            });
        }
        
        // Submit rage
        function submitRage() {
            const rageText = document.getElementById('rageTextarea').value.trim();
            const submitBtn = document.getElementById('rageSubmitBtn');
            
            if (!selectedZoneForRage) {
                showNotification('Please select a hashtag to rage about', 'error');
                return;
            }
            
            if (rageText.length < 10) {
                showNotification('Minimum 10 characters required', 'error');
                return;
            }
            
            if (rageText.length > 280) {
                showNotification('Maximum 280 characters', 'error');
                return;
            }
            
            // Show loading
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> POSTING RAGE...';
            submitBtn.disabled = true;
            
            // Save to localStorage
            const rageData = {
                text: rageText,
                hashtag: selectedZoneForRage.name,
                zone: selectedZoneForRage.zone,
                timestamp: new Date().toISOString(),
                username: username
            };
            
            // Save selected hashtags and mark onboarding complete
            const selectedHashtagNames = selectedHashtags.map(h => h.name);
            localStorage.setItem('nope_selected_hashtags', JSON.stringify(selectedHashtagNames));
            localStorage.setItem('nope_onboarding_complete', 'true');
            
            // Save rage post
            const existingRages = JSON.parse(localStorage.getItem('nope_rages') || '[]');
            existingRages.push(rageData);
            localStorage.setItem('nope_rages', JSON.stringify(existingRages));
            
            console.log('Rage posted:', rageData);
            
            // Show success
            setTimeout(() => {
                showNotification('Rage posted successfully! üî•', 'success');
                
                // Redirect to wall
                setTimeout(() => {
                    window.location.href = 'wall.html';
                }, 1500);
            }, 1000);
        }
        
        // Show notification
        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existing = document.querySelector('.nope-notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = 'nope-notification';
            notification.textContent = message;
            
            const bgColor = type === 'error' ? '#ff3b30' : 
                           type === 'success' ? '#34c759' : '#1a1a1a';
            
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${bgColor};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                z-index: 9999;
                animation: slideIn 0.3s ease;
                font-weight: 600;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.1);
                max-width: 300px;
            `;
            
            document.body.appendChild(notification);
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', init);
        
        // Debug function
        window.debugOnboarding = function() {
            console.log('=== ONBOARDING DEBUG ===');
            console.log('Selected hashtags:', selectedHashtags);
            console.log('Selected for rage:', selectedZoneForRage);
            console.log('Max selection:', MAX_SELECTION);
            console.log('========================');
        };
    </script>
</body>
</html>
